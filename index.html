<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intellisense AI - Ativo de Guerra: Simulador Operacional Nacional (v3.0)</title>
    
    <!-- M√ìDULO 2: Tipografia Elevada (Manrope/Inter) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Manrope:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- √çcones Vetoriais de Alta Qualidade (Feather Icons) -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    <!-- Gr√°ficos de Pizza para SWOT (Chart.js) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <style>
        /* M√ìDULO 2: REFINAMENTO VISUAL v3.0 - Luxo e Sofistica√ß√£o */
        :root {
            --color-primary: #0a84ff; 
            --color-danger: #ff453a; 
            --color-success: #34c759; 
            --color-bg-dark: #121212; 
            --color-bg-gradient-start: #1c1c1e;
            --color-bg-gradient-end: #121212;
            --color-text-light: #f2f2f7;
            --color-card-bg: rgba(44, 44, 46, 0.6); 
            --color-card-border: rgba(58, 58, 60, 0.4); 
            --font-family: 'Manrope', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --backdrop-blur: 15px; 
            --swot-quadrant-bg: rgba(68, 68, 70, 0.8); /* Fundo sutil para os quadrantes */
        }
        body {
            font-family: var(--font-family);
            background: radial-gradient(circle at top left, var(--color-bg-gradient-start) 0%, var(--color-bg-gradient-end) 100%); 
            color: var(--color-text-light);
            margin: 0;
            padding: 2rem;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
        }
        .dashboard {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            display: grid;
            gap: 2rem;
            grid-template-columns: repeat(12, 1fr);
            opacity: 0; 
            transform: translateY(20px); 
            animation: fadeInSlideUp 0.8s ease-out forwards;
        }
        .card {
            background-color: var(--color-card-bg);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--color-card-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            /* Efeito "Glassmorphism" */
            backdrop-filter: blur(var(--backdrop-blur));
            -webkit-backdrop-filter: blur(var(--backdrop-blur));
        }
        h1, h2, h3 { margin-top: 0; font-weight: 600; }
        h1 { font-size: 2.5rem; color: white; letter-spacing: 0.05em; }
        h2 { color: var(--color-primary); border-bottom: 1px solid var(--color-card-border); padding-bottom: 0.75rem; margin-bottom: 1rem; font-size: 1.5rem; display: flex; align-items: center;}
        h2 i { margin-right: 10px; } 
        h3 { font-size: 1.2rem; color: var(--color-text-light); opacity: 0.8; }

        /* --- Layout Espec√≠fico --- */
        .header { grid-column: 1 / -1; text-align: center; margin-bottom: 2rem; }
        .cost-calculator { grid-column: 1 / -1; text-align: center; animation-delay: 0.2s; }
        .heatmap { grid-column: 1 / 8; animation-delay: 0.4s; }
        .ticket-simulator-wrapper { grid-column: 8 / -1; animation-delay: 0.6s; }
        
        /* M√≥dulo 1: Anima√ß√£o de Entrada (Stagger Animation) */
        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Calculadora do Custo da Inefici√™ncia */
        #revenue-lost {
            font-size: 5rem;
            color: var(--color-danger);
            font-weight: 700;
            text-align: center;
            margin: 1rem 0;
            animation: pulse 1.5s infinite alternate;
            text-shadow: 0 0 20px var(--color-danger); 
        }
        @keyframes pulse {
            from { transform: scale(1); text-shadow: 0 0 20px rgba(255, 69, 58, 0.4); }
            to { transform: scale(1.03); text-shadow: 0 0 35px rgba(255, 69, 58, 0.8); }
        }
        input[type="range"] {
            width: 60%; margin: 1rem auto;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: var(--color-card-border);
            outline: none;
            border-radius: 5px;
            transition: background 0.2s ease;
        }

        /* M√≥dulo 1: Interatividade do Mapa de Calor */
        #heatmap-container { display: flex; flex-direction: column; gap: 8px; }
        .bar {
            height: 35px; background: linear-gradient(90deg, var(--color-primary) 0%, #0a84ff88 100%);
            color: white; text-align: left; padding-left: 15px; line-height: 35px;
            border-radius: 6px; font-weight: 500; transition: all 0.3s ease;
            display: flex; justify-content: space-between; padding-right: 15px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-sizing: border-box; /* Garante que o padding/border n√£o aumente o tamanho */
        }
        .bar:hover { cursor: help; transform: scale(1.01); } 
        .bar.active-drilldown {
            transform: scale(1.03);
            border: 2px solid var(--color-success);
            box-shadow: 0 0 15px rgba(52, 199, 89, 0.5);
        }
        .bar.faded { opacity: 0.3; } 

        /* Simulador de Tickets */
        .guest-view button {
            background-color: var(--color-primary); color: white; cursor: pointer; font-weight: 600; border: none;
            transition: transform 0.1s ease;
        }
        .guest-view button:active { transform: scale(0.98); } /* Feedback T√°til */
        .ticket-card {
            background-color: #3a3a3c; padding: 12px; margin-bottom: 10px;
            border-left: 4px solid var(--color-danger); border-radius: 6px; font-size: 0.9rem;
            opacity: 0; transform: translateY(20px); 
            animation: slideInTicket 0.3s ease-out forwards; /* M√≥dulo 1: Deslizamento de Ticket */
        }
        @keyframes slideInTicket {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .status-solved { color: var(--color-success); font-weight: 700; } 
        .ticket-card .action-button {
            background-color: var(--color-success);
            color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;
            margin-top: 10px; font-size: 0.8rem; transition: background-color 0.2s ease;
        }
        .ticket-card .action-button:hover { background-color: #28a745; }
        .ticket-card .ia-solution {
            font-size: 0.85rem; color: var(--color-success); margin-top: 10px; padding-top: 8px;
            border-top: 1px dashed var(--color-card-border);
        }
        
        /* PRIORIDADE 2: Modal de An√°lise SWOT */
        .swot-modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.9); /* Fundo escurecido */
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .swot-modal-overlay.open {
            display: flex;
            opacity: 1;
        }
        .swot-modal {
            width: 90%; 
            max-width: 1400px;
            height: 90vh;
            background-color: var(--color-card-bg);
            border-radius: 15px;
            border: 1px solid var(--color-primary);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
            padding: 30px;
            position: relative;
            overflow-y: auto;
            backdrop-filter: blur(var(--backdrop-blur));
        }
        .swot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--color-card-border);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        .swot-header h2 {
            font-size: 2rem;
            margin: 0;
            border-bottom: none;
            padding-bottom: 0;
        }
        .close-button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.5rem;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }
        .close-button:hover { opacity: 1; }
        
        .swot-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            height: calc(100% - 70px);
        }
        .swot-quadrant {
            background-color: var(--swot-quadrant-bg);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid var(--color-card-border);
            overflow-y: auto;
        }
        .swot-quadrant h3 {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 15px;
            opacity: 1;
        }
        
        .quadrant-strengths h3 { color: var(--color-success); }
        .quadrant-weaknesses h3 { color: var(--color-danger); }
        .quadrant-opportunities h3 { color: var(--color-primary); }
        .quadrant-threats h3 { color: #ff9f0a; /* Laranja para Amea√ßas */ }

        .metric-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.95rem;
        }
        .metric-table th, .metric-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid var(--color-card-border);
        }
        .metric-table th {
            color: var(--color-primary);
            font-weight: 600;
            text-transform: uppercase;
        }
        .metric-table tr:last-child td {
            border-bottom: none;
        }
        .chart-container {
            margin-top: 20px;
            padding: 10px;
            background-color: #3a3a3c;
            border-radius: 8px;
        }
        
    </style>
</head>
<body>

    <div class="dashboard">
        <header class="header">
            <h1>Intellisense AI - Ativo de Guerra: Simulador Operacional Nacional</h1>
            <p>Dashboard de Efici√™ncia - A Forja da Persuas√£o Digital</p>
        </header>

        <div class="card cost-calculator" id="cost-calculator-card">
            <h2><i data-feather="dollar-sign"></i> Calculadora do Custo da Inefici√™ncia</h2>
            <p>Taxa de N√£o-Retorno de Clientes Insatisfeitos (Slider)</p>
            <input type="range" id="non-return-rate" min="1" max="50" value="15" step="1">
            <p>Taxa Estimada de N√£o-Retorno: <span id="rate-display">15</span>%</p>
            <h3>Receita Anual Perdida: <span id="category-loss-text" style="font-size: 0.7em; opacity: 0.7;"></span></h3>
            <div id="revenue-lost">R$ 0,00</div>
            <small>*Ticket M√©dio Anual Definido: R$ 3.500.000 (Base de 10.000 h√≥spedes).</small>
        </div>

        <div class="card heatmap" id="heatmap-card">
            <h2><i data-feather="activity"></i> Mapa de Calor de Falhas (Argos Data)</h2>
            <p>An√°lise de 500 avalia√ß√µes negativas - √Åreas de Maior Severidade</p>
            <div id="heatmap-container">
                <div class="bar" data-category="Check-in" data-severity="85" title="Exemplo: 'Check-in de 1 hora. Inaceit√°vel.'">
                    <span class="bar-label">Check-in</span> <span class="bar-value">(85%)</span>
                </div>
                <div class="bar" data-category="Piscina/√Årea Externa" data-severity="70" title="Exemplo: 'Toalhas sujas e piscina lotada, sem controle.'">
                    <span class="bar-label">Piscina/√Årea Externa</span> <span class="bar-value">(70%)</span>
                </div>
                <div class="bar" data-category="Servi√ßo de Quarto" data-severity="55" title="Exemplo: 'Servi√ßo de quarto demorou 45 minutos para um caf√©.'">
                    <span class="bar-label">Servi√ßo de Quarto</span> <span class="bar-value">(55%)</span>
                </div>
                <div class="bar" data-category="Manuten√ß√£o" data-severity="40" title="Exemplo: 'Ar-condicionado quebrado, tive que ligar 3 vezes.'">
                    <span class="bar-label">Manuten√ß√£o</span> <span class="bar-value">(40%)</span>
                </div>
                <div class="bar" data-category="A&B" data-severity="20" title="Exemplo: 'Bar na cobertura caro e gar√ßom confuso.'">
                    <span class="bar-label">A&B</span> <span class="bar-value">(20%)</span>
                </div>
            </div>
            <small>Passe o mouse para ver exemplos e **clique em uma barra para An√°lise SWOT**.</small>
        </div>

        <div class="card ticket-simulator-wrapper" id="ticket-simulator-card">
            <h2 id="ticket-simulator-title"><i data-feather="tag"></i> Simulador de Tickets Inteligentes</h2>
            <div class="guest-view">
                <h3>Vis√£o do H√≥spede</h3>
                <p>Simulador: App de Reporte R√°pido</p>
                <input type="text" id="problem-input" placeholder="Qual o problema? Ex: 'Ar-condicionado n√£o gela.'">
                <button id="report-button">üö® Reportar Problema</button>
            </div>
            <hr style="border-color: var(--color-card-border); margin: 1.5rem 0;">
            <div class="manager-view">
                <h3>Vis√£o do Gerente</h3>
                <p>Tickets Abertos (Onde o tempo est√° correndo)</p>
                <div id="ticket-list"></div>
            </div>
        </div>
    </div>

    <!-- PRIORIDADE 2: Modal de An√°lise SWOT (Inicialmente Oculto) -->
    <div class="swot-modal-overlay" id="swot-modal-overlay">
        <div class="swot-modal" id="swot-modal">
            <div class="swot-header">
                <h2 id="swot-title">An√°lise SWOT Detalhada</h2>
                <button class="close-button" id="close-swot-modal"><i data-feather="x"></i></button>
            </div>
            <div class="swot-grid" id="swot-grid-content">
                <!-- Conte√∫do SWOT ser√° injetado aqui -->
            </div>
        </div>
    </div>

    <script>
        // Inicializa Feather Icons
        feather.replace();

        // Vari√°veis Globais e Configura√ß√µes
        let ticketIdCounter = 1;
        const BASE_ANNUAL_REVENUE = 3500000;
        const intervalId = setInterval(updateTimers, 1000);
        let activeCategory = null; 
        
        // Dados para An√°lise SWOT (M√ìDULO 3.1)
        const SWOTData = {
            "Check-in": {
                severity: 85, impact: 0.4,
                SWOT: {
                    strengths: ["Localiza√ß√£o ic√¥nica e premium.", "Marca com forte apelo hist√≥rico no mercado de luxo.", "Design de interiores premiado e reconhecido."],
                    weaknesses: [
                        { metric: "Tempo M√©dio de Espera", value: "35 min", impact: "Negativo (M√° Experi√™ncia Inicial)" },
                        { metric: "Taxa de Reclama√ß√£o", value: "35%", impact: "Alto (Feedback Imediato)" }
                    ],
                    chart: {
                        title: "Composi√ß√£o das Reclama√ß√µes de Check-in",
                        labels: ["Lentid√£o do Sistema", "Falta de Pessoal", "Erros de Reserva", "Burocracia"],
                        data: [50, 30, 10, 10],
                        colors: ['#0a84ff', '#ff9f0a', '#ff453a', '#34c759']
                    },
                    opportunities: ["Implementar sistema de pr√©-check-in via app (Redu√ß√£o de 90% no tempo de espera).", "Usar dados do h√≥spede para oferecer upsells personalizados antes da chegada.", "Liberar a equipe da recep√ß√£o para atuar como 'concierges de boas-vindas'."],
                    threats: ["Perda de 25% dos clientes de primeira viagem devido a uma m√° impress√£o.", "Avalia√ß√µes negativas constantes minando o status de 'hotel de luxo'.", "Concorrentes j√° utilizam tecnologia para agilizar o processo."]
                }
            },
            "Piscina/√Årea Externa": {
                severity: 70, impact: 0.3,
                SWOT: {
                    strengths: ["Design paisag√≠stico e vista deslumbrante.", "Amplo espa√ßo de lazer.", "Oferta de coquet√©is exclusivos."],
                    weaknesses: [
                        { metric: "Taxa de Ocupa√ß√£o Cr√≠tica", value: "70%", impact: "Percep√ß√£o de Superlota√ß√£o" },
                        { metric: "Tempo de Limpeza/Reposi√ß√£o", value: "Alto", impact: "Quebra de Padr√£o Higi√™nico" }
                    ],
                    chart: {
                        title: "Motivos de Insatisfa√ß√£o na √Årea Externa",
                        labels: ["Superlota√ß√£o", "Falta de Toalhas Limpas", "Servi√ßo Lento", "Limpeza Deficiente"],
                        data: [40, 30, 15, 15],
                        colors: ['#ff453a', '#ff9f0a', '#0a84ff', '#34c759']
                    },
                    opportunities: ["Monitoramento de ocupa√ß√£o em tempo real (IA).", "Otimiza√ß√£o da equipe de limpeza e servi√ßo por demanda.", "Cria√ß√£o de √°reas VVIP controladas por acesso."],
                    threats: ["Perda de exclusividade.", "Multas sanit√°rias por descumprimento de normas.", "Coment√°rios em m√≠dias sociais sobre 'piscina lotada'."]
                }
            },
            // ... outros dados (simplificados para brevidade)
            "Servi√ßo de Quarto": { severity: 55, impact: 0.2, SWOT: { strengths: [], weaknesses: [{ metric: "Tempo de Entrega", value: "45 min", impact: "Insatisfa√ß√£o" }], opportunities: ["Roteiriza√ß√£o Inteligente"], threats: ["Pedidos Cancelados"] } },
            "Manuten√ß√£o": { severity: 40, impact: 0.15, SWOT: { strengths: [], weaknesses: [{ metric: "Rechamadas", value: "3x", impact: "Frustra√ß√£o" }], opportunities: ["Sensores IoT / Preditiva"], threats: ["Custo de Emerg√™ncia"] } },
            "A&B": { severity: 20, impact: 0.05, SWOT: { strengths: [], weaknesses: [{ metric: "Avalia√ß√£o Qualitativa", value: "2.5/5", impact: "Baixa Qualidade" }], opportunities: ["Otimiza√ß√£o de Card√°pio por IA"], threats: ["Evitar Consumo Interno"] } }
        };

        // --- Elementos DOM ---
        const rateSlider = document.getElementById('non-return-rate');
        const rateDisplay = document.getElementById('rate-display');
        const revenueLostDisplay = document.getElementById('revenue-lost');
        const categoryLossText = document.getElementById('category-loss-text');
        const reportButton = document.getElementById('report-button');
        const problemInput = document.getElementById('problem-input');
        const ticketList = document.getElementById('ticket-list');
        const heatmapBars = document.querySelectorAll('.bar');
        const swotModalOverlay = document.getElementById('swot-modal-overlay');
        const swotTitle = document.getElementById('swot-title');
        const swotGridContent = document.getElementById('swot-grid-content');
        const closeSwotModalButton = document.getElementById('close-swot-modal');

        let tickets = [];
        let chartInstance = null; // Para armazenar a inst√¢ncia do Chart.js

        // --- PRIORIDADE 1: CORRE√á√ÉO DO BUG CR√çTICO ---
        function updateRevenueLost() {
            const baseRate = parseInt(rateSlider.value) / 100;
            rateDisplay.textContent = rateSlider.value;
            let currentLostRevenue = 0;
            let currentLossText = "";

            if (activeCategory && SWOTData[activeCategory]) {
                // C√°lculo espec√≠fico para a categoria ativa
                const data = SWOTData[activeCategory];
                // A perda por categoria √© uma porcentagem da perda total (BASE * Rate)
                const totalLoss = BASE_ANNUAL_REVENUE * baseRate;
                currentLostRevenue = Math.round(totalLoss * data.impact);
                currentLossText = `Perda estimada apenas por falhas em "${activeCategory}":`;
            } else {
                // C√°lculo geral (o valor do slider afeta diretamente a perda total)
                currentLostRevenue = Math.round(BASE_ANNUAL_REVENUE * baseRate);
                currentLossText = "Perda total estimada:";
            }
            
            revenueLostDisplay.textContent = 'R$ ' + currentLostRevenue.toLocaleString('pt-BR');
            categoryLossText.textContent = currentLossText;
        }

        rateSlider.addEventListener('input', updateRevenueLost);
        updateRevenueLost(); // **Chamada Inicial para Consertar o Bug**

        // --- PRIORIDADE 2: L√≥gica do Modal SWOT ---
        heatmapBars.forEach(bar => {
            bar.addEventListener('click', () => {
                const category = bar.dataset.category;
                
                // Resetar estados visuais (diminui√ß√£o de opacidade das outras barras)
                heatmapBars.forEach(b => {
                    b.classList.remove('active-drilldown', 'faded');
                });
                bar.classList.add('active-drilldown');

                // Aplicar fade-out nas outras barras
                heatmapBars.forEach(b => {
                    if (b !== bar) {
                        b.classList.add('faded');
                    }
                });


                activeCategory = category;
                updateRevenueLost(); // Recalcular a receita com a categoria ativa

                // Abrir e Renderizar Modal
                renderSWOTModal(category);
            });
        });

        // Evento para fechar o modal
        closeSwotModalButton.addEventListener('click', closeSWOTModal);
        swotModalOverlay.addEventListener('click', (event) => {
            if (event.target === swotModalOverlay) {
                closeSWOTModal();
            }
        });

        function closeSWOTModal() {
            swotModalOverlay.classList.remove('open');
            // Resetar o estado visual do mapa de calor
            heatmapBars.forEach(b => {
                b.classList.remove('active-drilldown', 'faded');
            });
            activeCategory = null;
            updateRevenueLost(); // Recalcular para perda total
        }

        function renderSWOTModal(category) {
            const data = SWOTData[category];
            if (!data) return;

            swotTitle.innerHTML = `<i data-feather="monitor"></i> An√°lise SWOT: ${category}`;

            const strengths = data.SWOT.strengths.map(s => `<li>${s}</li>`).join('');
            const weaknessesTable = data.SWOT.weaknesses.map(w => 
                `<tr><td>${w.metric}</td><td>${w.value}</td><td>${w.impact}</td></tr>`
            ).join('');
            const opportunities = data.SWOT.opportunities.map(o => `<li>${o}</li>`).join('');
            const threats = data.SWOT.threats.map(t => `<li>${t}</li>`).join('');

            const html = `
                <div class="swot-quadrant quadrant-strengths">
                    <h3>For√ßas (Strengths)</h3>
                    <ul>${strengths}</ul>
                </div>
                <div class="swot-quadrant quadrant-weaknesses">
                    <h3>Fraquezas (Weaknesses)</h3>
                    <p>M√©tricas Operacionais de Falha:</p>
                    <table class="metric-table">
                        <thead><tr><th>M√©trica</th><th>Valor</th><th>Impacto</th></tr></thead>
                        <tbody>${weaknessesTable}</tbody>
                    </table>
                    <div class="chart-container">
                        <h4>${data.SWOT.chart.title}</h4>
                        <canvas id="swot-pie-chart"></canvas>
                    </div>
                </div>
                <div class="swot-quadrant quadrant-opportunities">
                    <h3>Oportunidades (Opportunities)</h3>
                    <ul>${opportunities}</ul>
                </div>
                <div class="swot-quadrant quadrant-threats">
                    <h3>Amea√ßas (Threats)</h3>
                    <ul>${threats}</ul>
                </div>
            `;

            swotGridContent.innerHTML = html;
            swotModalOverlay.classList.add('open');
            feather.replace(); // Recarregar √≠cones no modal

            // Renderizar Gr√°fico de Pizza (Chart.js)
            const ctx = document.getElementById('swot-pie-chart').getContext('2d');
            
            if (chartInstance) {
                chartInstance.destroy();
            }

            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.SWOT.chart.labels,
                    datasets: [{
                        data: data.SWOT.chart.data,
                        backgroundColor: data.SWOT.chart.colors,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: 'var(--color-text-light)' }
                        },
                        title: {
                            display: false
                        }
                    }
                }
            });
        }

        // --- L√≥gica do Simulador de Tickets (Retido da Ordem anterior) ---
        reportButton.addEventListener('click', () => {
            const problemText = problemInput.value.trim();
            if (problemText === '') return;

            const newTicket = {
                id: `IS-2025${String(ticketIdCounter++).padStart(4, '0')}`,
                problem: problemText,
                status: 'ABERTO',
                startTime: Date.now(),
                elapsedTime: 0
            };

            tickets.unshift(newTicket);
            renderTicket(newTicket);
            problemInput.value = '';
        });

        function renderTicket(ticket) {
            const ticketCard = document.createElement('div');
            ticketCard.className = 'ticket-card';
            ticketCard.dataset.ticketId = ticket.id;
            
            ticketCard.innerHTML = `
                <strong>ID: ${ticket.id}</strong><br>
                Problema: ${ticket.problem}<br>
                Status: <span class="status-open">${ticket.status}</span> | Tempo de Resposta: <span class="timer" data-id="${ticket.id}">00:00</span>
                <button class="action-button" data-id="${ticket.id}">Solu√ß√£o Inteligente (IA)</button>
            `;
            
            ticketList.prepend(ticketCard); 
        }

        // --- A√ß√£o "Solu√ß√£o Inteligente (IA)" nos Tickets ---
        ticketList.addEventListener('click', (event) => {
            if (event.target.classList.contains('action-button')) {
                const ticketId = event.target.dataset.id;
                const ticket = tickets.find(t => t.id === ticketId);
                const cardElement = document.querySelector(`.ticket-card[data-ticket-id="${ticketId}"]`);
                
                if (ticket && cardElement && ticket.status === 'ABERTO') {
                    // Parar timer e atualizar status
                    const elapsed = Math.floor((Date.now() - ticket.startTime) / 1000);
                    ticket.elapsedTime = elapsed;
                    ticket.status = 'RESOLVIDO (IA)';
                    
                    // Atualiza√ß√£o Visual
                    const timerSpan = cardElement.querySelector('.timer');
                    const statusSpan = cardElement.querySelector('.status-open') || cardElement.querySelector('.status-solved');

                    if (statusSpan) {
                        statusSpan.textContent = ticket.status;
                        statusSpan.className = 'status-solved';
                    }
                    if (timerSpan) {
                        timerSpan.parentElement.style.borderLeftColor = 'var(--color-success)'; 
                    }

                    // Remover bot√£o e adicionar nota de solu√ß√£o
                    event.target.remove();
                    
                    const solutionNote = document.createElement('div');
                    solutionNote.className = 'ia-solution';
                    
                    // Exemplo de Mensagem Contextual
                    let solutionMsg = "Recomenda√ß√£o de A√ß√£o Imediata (Argos): Enviar equipe para o setor de Check-in para reduzir a fila.";
                    if (ticket.problem.toLowerCase().includes('ar-condicionado') || ticket.problem.toLowerCase().includes('vazamento')) {
                         solutionMsg = "Recomenda√ß√£o de A√ß√£o Imediata (Argos): Enviar Manuten√ß√£o (Tipo: HVAC/Hidr√°ulica) para o quarto. Alarme de falha proativa acionado.";
                    }
                    
                    solutionNote.innerHTML = `<strong>Resposta Argos (T=${String(Math.floor(elapsed)).padStart(2, '0')}s):</strong> ${solutionMsg}`;
                    cardElement.appendChild(solutionNote);
                }
            }
        });


        function updateTimers() {
            const timers = document.querySelectorAll('.timer');
            timers.forEach(timerElement => {
                const ticketId = timerElement.dataset.id;
                const ticket = tickets.find(t => t.id === ticketId);
                if (ticket && ticket.status === 'ABERTO') {
                    const elapsed = Math.floor((Date.now() - ticket.startTime) / 1000);
                    const minutes = String(Math.floor(elapsed / 60)).padStart(2, '0');
                    const seconds = String(elapsed % 60).padStart(2, '0');
                    timerElement.textContent = `${minutes}:${seconds}`;
                    
                    // Alerta de Inefici√™ncia (Amarelo ap√≥s 120s)
                    if (elapsed > 120) {
                        timerElement.style.color = '#ffcc00'; /* Amarelo (iOS System Yellow) */
                        timerElement.parentElement.style.borderLeftColor = '#ffcc00';
                    }
                }
            });
        }
    </script>
</body>
</html>
